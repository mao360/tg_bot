# Архитектура Telegram Bot

## Структура проекта

```
tg_bot/
├── cmd/bot/main.go              # Точка входа приложения
├── internal/                    # Внутренняя логика приложения
│   ├── bot/                     # Основная логика бота
│   │   ├── bot.go              # Главный файл бота
│   │   ├── handlers/           # Обработчики событий
│   │   │   ├── message.go      # Обработка сообщений
│   │   │   ├── callback.go     # Обработка callback'ов
│   │   │   └── payment.go      # Обработка платежей
│   │   └── middleware/          # Middleware (пока не используется)
│   ├── services/               # Бизнес-логика
│   │   ├── payment/           # Сервис платежей
│   │   ├── user/              # Сервис пользователей
│   │   └── subscription/      # Сервис подписок (пока не используется)
│   ├── models/                # Модели данных
│   │   ├── user.go           # Модель пользователя
│   │   ├── payment.go        # Модель платежа
│   │   └── subscription.go   # Модель подписки
│   ├── config/               # Конфигурация
│   │   └── config.go        # Загрузка конфигурации
│   └── database/            # Работа с базой данных (пока не используется)
├── pkg/                     # Переиспользуемые компоненты
│   ├── logger/              # Логирование
│   ├── validator/           # Валидация (пока не используется)
│   └── utils/              # Утилиты (пока не используются)
├── migrations/              # Миграции БД (пока не используются)
├── scripts/                # Скрипты сборки и деплоя
├── tests/                   # Тесты
│   ├── integration/         # Интеграционные тесты
│   └── unit/               # Юнит тесты
└── docs/                   # Документация
```

## Принципы архитектуры

### 1. Разделение ответственности
- **Handlers** - обработка входящих запросов от Telegram
- **Services** - бизнес-логика приложения
- **Models** - структуры данных
- **Config** - конфигурация приложения

### 2. Dependency Injection
Все зависимости инжектируются через конструкторы, что упрощает тестирование и делает код более гибким.

### 3. Clean Architecture
Слои архитектуры:
- **Presentation Layer** (handlers) - обработка HTTP/Telegram запросов
- **Business Layer** (services) - бизнес-логика
- **Data Layer** (models) - структуры данных

## Запуск

### Локальная разработка
```bash
# Установка зависимостей
go mod download

# Запуск с переменными окружения
TELEGRAM_BOT_TOKEN=your_token go run cmd/bot/main.go
```

### Docker
```bash
# Сборка и запуск через Docker Compose
docker-compose up --build
```

## Переменные окружения

Скопируйте `env.example` в `.env` и заполните необходимые значения:

- `TELEGRAM_BOT_TOKEN` - токен бота от @BotFather
- `PAYMENT_PROVIDER_TOKEN` - токен платежного провайдера
- `LOG_LEVEL` - уровень логирования (debug, info, warn, error)
- `ENVIRONMENT` - окружение (development, production)
- `DEBUG` - режим отладки (true/false)

## Развитие проекта

### Следующие шаги:
1. Добавить базу данных (PostgreSQL)
2. Реализовать репозитории для работы с данными
3. Добавить миграции БД
4. Написать тесты
5. Добавить мониторинг и метрики
6. Настроить CI/CD
